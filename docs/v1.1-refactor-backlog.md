# Maestro v1.1 Refactor Backlog

Date: February 23, 2026
Status: Started

## Goals

- Reduce component complexity and make behavior easier to reason about.
- Move workflow orchestration from React components into testable modules.
- Standardize date/env handling and improve failure diagnostics.
- Add stronger integration/e2e safety nets before feature expansion.

## Priority Order

## R1. Dashboard Decomposition (P0)

Why:
- `src/features/dashboard/DashboardPage.tsx` is large and mixes rendering, data loading, validation, and side effects.

Tasks:
- Extract skill-log draft mapping/validation/orchestration helpers into `dashboard` domain module(s).
- Add focused tests for the extracted workflow logic.
- Keep behavior unchanged.

Exit criteria:
- `DashboardPage` line count decreases and workflow code lives outside component body.
- Graduation flow and skill-entry validation are unit-tested.

## R2. Skills API Split (P0)

Why:
- `src/features/skills/skillsApi.ts` bundles read, write, and summary logic in one file.

Tasks:
- Split into:
  - `skillsQueries.ts`
  - `skillsMutations.ts`
  - `skillsSummaries.ts`
- Keep exported facade stable for pages.

Exit criteria:
- Smaller modules with clearer ownership and test boundaries.

## R3. Shared Date Utilities (P1)

Why:
- Date math is duplicated across dashboard/review/skills and mixes local date boundaries with UTC timestamps.

Tasks:
- Add `src/lib/date.ts` for local-date parse/format/day-diff helpers.
- Replace duplicated helpers in dashboard/review/skills modules.

Exit criteria:
- Single source of truth for local-date behavior.

## R4. Startup Failure UX (P1)

Why:
- Missing env vars currently crash at startup with blank screen.

Tasks:
- Add app-level error boundary + fatal error page for startup failures.
- Preserve strict env checks while giving actionable UI guidance.

Exit criteria:
- Missing env in prod shows an explicit error page, not blank screen.

## R5. Route-Level Code Splitting (P2)

Why:
- Initial bundle can be reduced with lazy loading for feature routes.

Tasks:
- Lazy-load non-auth feature pages in router.
- Keep auth route fast and deterministic.

Exit criteria:
- Initial JS payload decreases and routes still navigate cleanly.

## R6. E2E Smoke Coverage (P1)

Why:
- Current tests are mostly unit/integration with mocks.

Tasks:
- Add Playwright smoke flow:
  - auth
  - log output
  - skill log add/edit
  - completion -> zero cleanup behavior

Exit criteria:
- CI/local e2e smoke protects critical user path regressions.

## Current Slice

- Completed: `R1 Dashboard Decomposition` (workflow extraction + tests).
- Completed: `R2 Skills API Split` (queries/mutations/summaries modules + stable facade exports).
- Completed: `R3 Shared Date Utilities` (`src/lib/date.ts` adopted by dashboard/review/skills/metrics).
- Completed: `R4 Startup Failure UX` (startup config error screen + guarded bootstrap).
- Completed: `R5 Route-Level Code Splitting` (lazy-loaded non-auth routes in `src/app/App.tsx`).
